╭────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Plan to implement                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                            │
│ dotfiles-mac → dotfiles クロスプラットフォーム統合                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                            │
│ コンテキスト                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                            │
│ macOS 専用の dotfiles-mac リポジトリを、WSL (Ubuntu) でも動作するように拡張する。同時にリポジトリ名を dotfiles に変更し、全内部参照も更新する。作業は feature/cross-platform ブランチで行い、main を直接変更しない。                                                       │
│                                                                                                                                                                                                                                                                            │
│ ---                                                                                                                                                                                                                                                                        │
│ ブランチ戦略                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                            │
│ 1. dotfiles-linux ブランチを作成（ローカルディレクトリは ~/dotfiles-mac のまま）                                                                                                                                                                                           │
│ 2. ブランチ上でコード変更をすべて完了、push まで実施                                                                                                                                                                                                                       │
│ 3. マージはしない — ユーザーが WSL 上で clone してテストしてから判断                                                                                                                                                                                                       │
│ 4. GitHub リネーム + ローカルディレクトリリネームもマージ後に実施                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                            │
│ ---                                                                                                                                                                                                                                                                        │
│ 変更一覧（30ファイル）                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                            │
│ Step 1: 新規ファイル作成                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                            │
│ zsh/os-detect.sh（新規）                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                            │
│ OS 判定ヘルパー。IS_MACOS, IS_WSL, IS_LINUX フラグを設定。                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                            │
│ IS_MACOS=0; IS_WSL=0; IS_LINUX=0                                                                                                                                                                                                                                           │
│ if [[ "$OSTYPE" == darwin* ]]; then                                                                                                                                                                                                                                        │
│     IS_MACOS=1                                                                                                                                                                                                                                                             │
│ elif grep -qi microsoft /proc/version 2>/dev/null; then                                                                                                                                                                                                                    │
│     IS_WSL=1                                                                                                                                                                                                                                                               │
│ else                                                                                                                                                                                                                                                                       │
│     IS_LINUX=1                                                                                                                                                                                                                                                             │
│ fi                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                            │
│ Step 2: dotfiles-mac → dotfiles 全参照の一括置換                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                            │
│ 対象ファイルと箇所:                                                                                                                                                                                                                                                        │
│ ┌──────────────────────────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐                                                                                                      │
│ │                   ファイル                   │                                                      変更箇所                                                      │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ zsh/zshenv                                   │ ZDOTDIR のパス                                                                                                     │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ zsh/zshrc                                    │ ZDOTDIR のパス                                                                                                     │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ zsh/exports.sh                               │ scripts PATH, $DOTFILES 変数, コメント                                                                             │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ scripts/bin/dump.sh                          │ $DOTFILES パス                                                                                                     │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ scripts/bin/launchd_manager.py               │ LaunchAgents パス                                                                                                  │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ scripts/bookmark/open_ai_urls.sh             │ コメント内パス                                                                                                     │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ scripts/john/README.md                       │ venv パス                                                                                                          │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ install/install-claude-code.sh               │ source パス                                                                                                        │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ LaunchAgents/com.yoshihide.setup_drive.plist │ スクリプトパス                                                                                                     │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ zsh/functions/excel, word, powerpoint        │ テンプレートパス → $DOTFILES/templates/ に統一                                                                     │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ CLAUDE.md                                    │ 全参照（5箇所） + WSL 対応の記述追加                                                                               │                                                                                                      │
│ ├──────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤                                                                                                      │
│ │ README.md                                    │ 全参照（11箇所） + WSL 対応の記述追加 + デフォルトシェル変更手順 (chsh -s $(which zsh)) をインストールガイドに追加 │                                                                                                      │
│ └──────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘                                                                                                      │
│ Python shebang の修正: scripts/bin/launchd_manager.py, scripts/ppdf/ppdf_crack, scripts/john/src/pdf2john.py の shebang を #!/usr/bin/env python3 に変更（クロスプラットフォーム対応）                                                                                     │
│                                                                                                                                                                                                                                                                            │
│ Step 3: zsh/zshrc の改修                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                            │
│ - source $ZDOTDIR/os-detect.sh を exports.sh の前に追加                                                                                                                                                                                                                    │
│ - iTerm2 shell integration を (( IS_MACOS )) で条件分岐                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                            │
│ Step 4: zsh/exports.sh の OS 分岐                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                            │
│ if (( IS_MACOS )); then                                                                                                                                                                                                                                                    │
│     # macOS: /opt/homebrew, /Applications/VS Code.app, /Library/TeX 等                                                                                                                                                                                                     │
│ else                                                                                                                                                                                                                                                                       │
│     # Linux/WSL: /snap/bin, Linuxbrew 等                                                                                                                                                                                                                                   │
│ fi                                                                                                                                                                                                                                                                         │
│ # 共通: $HOME/.local/bin, $HOME/dotfiles/scripts                                                                                                                                                                                                                           │
│ export DOTFILES="$HOME/dotfiles"                                                                                                                                                                                                                                           │
│ # SEM は macOS のみ                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                            │
│ Step 5: zsh/aliases.sh の OS 分岐                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                            │
│ # 共通: eza 系, git 系, web_search 系                                                                                                                                                                                                                                      │
│ # OS 分岐:                                                                                                                                                                                                                                                                 │
│ if (( IS_MACOS )); then                                                                                                                                                                                                                                                    │
│     alias o='open .'                                                                                                                                                                                                                                                       │
│     alias rm='trash'                                                                                                                                                                                                                                                       │
│     alias moodle='open -na "Google Chrome" ...'                                                                                                                                                                                                                            │
│ elif (( IS_WSL )); then                                                                                                                                                                                                                                                    │
│     alias o='explorer.exe .'                                                                                                                                                                                                                                               │
│     alias rm='trash-put'                                                                                                                                                                                                                                                   │
│     alias moodle='wslview "https://..."'                                                                                                                                                                                                                                   │
│ else                                                                                                                                                                                                                                                                       │
│     alias o='xdg-open .'                                                                                                                                                                                                                                                   │
│     alias rm='trash-put'                                                                                                                                                                                                                                                   │
│ fi                                                                                                                                                                                                                                                                         │
│ # Ubuntu 互換: bat → batcat, fd → fdfind のエイリアス                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                            │
│ Step 6: 関数のクロスプラットフォーム対応（11関数）                                                                                                                                                                                                                         │
│ ┌──────────────┬────────────────────────────┬──────────────────────────────────────┬────────────────────┐                                                                                                                                                                  │
│ │     関数     │           macOS            │                 WSL                  │       Linux        │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ open_command │ open                       │ wslview 追加                         │ xdg-open           │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ copypath     │ pbcopy                     │ clip.exe                             │ xclip              │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ copyfile     │ pbcopy                     │ clip.exe                             │ xclip              │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ excel        │ open -a                    │ wslview                              │ xdg-open           │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ word         │ open -a                    │ wslview                              │ xdg-open           │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ powerpoint   │ open -a                    │ wslview                              │ xdg-open           │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ awake        │ caffeinate                 │ systemd-inhibit                      │ systemd-inhibit    │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ lp           │ pmset                      │ メッセージ表示（非対応）             │ メッセージ表示     │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ update       │ brew update/upgrade        │ apt update/upgrade (+brew if exists) │ apt update/upgrade │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ newtex       │ open → open_command に変更 │ （自動対応）                         │ （自動対応）       │                                                                                                                                                                  │
│ ├──────────────┼────────────────────────────┼──────────────────────────────────────┼────────────────────┤                                                                                                                                                                  │
│ │ ghopen       │ open                       │ explorer.exe → wslview に変更        │ xdg-open           │                                                                                                                                                                  │
│ └──────────────┴────────────────────────────┴──────────────────────────────────────┴────────────────────┘                                                                                                                                                                  │
│ Step 7: install/bootstrap.sh 全面改修                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                            │
│ 構成:                                                                                                                                                                                                                                                                      │
│ 1. OS 判定（IS_MACOS / IS_WSL / IS_LINUX）                                                                                                                                                                                                                                 │
│ 2. macOS 専用: LaunchAgents セットアップ、pmset sudoers                                                                                                                                                                                                                    │
│ 3. Linux/WSL 専用: apt パッケージインストール（zsh, git, curl, ripgrep, trash-cli, xclip, wslu 等）、eza/zoxide/fzf/git-delta の個別インストール、bat→batcat / fd→fdfind のシンボリックリンク、デフォルトシェルを zsh に変更                                               │
│ 4. 共通: VSCODE_USER_DIR 環境変数設定（macOS: ~/Library/Application Support/Code/User, Linux: ~/.config/Code/User）、link_from_prop（zsh, git は共通、karabiner は macOS のみ、vscode は共通）、VS Code 拡張機能インストール、Homebrew パッケージ（macOS のみ）            │
│                                                                                                                                                                                                                                                                            │
│ Step 8: vscode/links.prop                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                            │
│ settings.json -> ${VSCODE_USER_DIR}/settings.json                                                                                                                                                                                                                          │
│ VSCODE_USER_DIR は bootstrap.sh で OS に応じて export される。                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                            │
│ Step 9: scripts/bin/dump.sh 改修                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                            │
│ - パス変更 dotfiles-mac → dotfiles                                                                                                                                                                                                                                         │
│ - brew コマンド存在チェック（macOS でも Linux でも対応）                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                            │
│ Step 10: scripts/bookmark/* の OS 分岐                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                            │
│ 3ファイル（open_chrome_personal.sh, open_chrome_chiba-u.sh, open_ai_urls.sh）に OS 分岐を追加。WSL では wslview、Linux では google-chrome を使用。                                                                                                                         │
│                                                                                                                                                                                                                                                                            │
│ ---                                                                                                                                                                                                                                                                        │
│ 今回の作業範囲                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                            │
│ - dotfiles-linux ブランチを作成し、全コード変更を実施                                                                                                                                                                                                                      │
│ - ブランチを push して完了（マージはしない）                                                                                                                                                                                                                               │
│ - ユーザーが WSL 上で clone してテスト                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                            │
│ ---                                                                                                                                                                                                                                                                        │
│ 検証方法                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                            │
│ macOS（既存環境が壊れていないこと）                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                            │
│ 1. source ~/.zshrc でエラーなし                                                                                                                                                                                                                                            │
│ 2. echo $DOTFILES → ~/dotfiles                                                                                                                                                                                                                                             │
│ 3. ll, la, lt が eza で動作                                                                                                                                                                                                                                                │
│ 4. trash testfile でゴミ箱に移動                                                                                                                                                                                                                                           │
│ 5. update で brew update が動作                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                            │
│ WSL (Ubuntu)（新規セットアップ）                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                            │
│ 1. ./install/bootstrap.sh で apt パッケージインストール + シンボリックリンク作成                                                                                                                                                                                           │
│ 2. exec zsh でシェル切替                                                                                                                                                                                                                                                   │
│ 3. echo $DOTFILES → ~/dotfiles                                                                                                                                                                                                                                             │
│ 4. ll, la, lt が eza で動作                                                                                                                                                                                                                                                │
│ 5. trash-put testfile / rm testfile でゴミ箱に移動                                                                                                                                                                                                                         │
│ 6. o で explorer.exe が起動                                                                                                                                                                                                                                                │
│ 7. copypath で clip.exe 経由でクリップボードにコピー                                                                                                                                                                                                                       │
│ 8. update で apt update が動作                                                                                                                                                                                                                                             │
│ 9. excel test で wslview 経由で Windows Excel が起動                                                                                                                                                                                                                       │
│ 10. git diff で delta 表示                                                                                                                                                                                                                                                 │
╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
